<template>
	<div v-if="showNotice" class="oldversion-notice">
		You are currently using the development branch. We kindly request you to suggest feutures or report bugs in <a href="">#testers</a> channel.
    <br />
    <a href="#" @click.prevent="dismiss">Dismiss this for a week.</a>
	</div>
</template>

<script>
import semver from 'semver';
import eventBus from '../eventBus.js';
import branches from '../mixins/branches.js';
export default {
	mixins: [branches],
	data() {
		return {
			hideUntil: null,
		};
	},
	computed: {
		showNotice() {
			return semver.satisfies(semver.coerce('2.x'), this.selectedBranch) && (!this.hideUntil || Date.now() > parseInt(this.hideUntil));
		},
	},
	mounted() {
		eventBus.$on('branch-update', this.updateBranch);
		this.hideUntil = localStorage.getItem('oldversion-notice-expiration');
	},
	destroyed() {
		eventBus.$off('branch-update', this.updateBranch);
	},
	methods: {
		dismiss() {
			const expirationTimestamp = Date.now() + (7 * 60 * 60 * 24 * 1000);
			this.hideUntil = expirationTimestamp;
			localStorage.setItem('oldversion-notice-expiration', expirationTimestamp);
		},
	},
};
</script>

<style lang="stylus">
.oldversion-notice {
	background-color: #fff;
	position: fixed;
	right: 15rem;
	bottom: 1rem;
	left: 15rem;
	padding: 1em;
	border: 1px solid #3eaf7c;
	border-radius: 4px;
	box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
	text-align: center;
	z-index: 100;
	@media (max-width: 959px) {
		left: 17.4rem;
	}
	@media (max-width: 719px) {
		left: 1rem;
	}
}
.jac-theme-dark .oldversion-notice {
	background-color: #1a1a1a;
}
.jac-theme-blue .oldversion-notice {
	border-color: #2196f3;
}
.jac-theme-red .oldversion-notice {
	border-color: #de3636;
}
.jac-theme-purple .oldversion-notice {
	border-color: #a846eb;
}
</style>
